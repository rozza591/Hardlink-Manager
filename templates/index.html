<!DOCTYPE html>
<html>

<head>
    <title>Hardlink Manager</title>
    <link rel="icon" href="/static/logos/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/app.js" defer></script>
</head>

<body>
    <div class="dark-toggle" id="darkToggle">Dark Mode</div>

    <div class="container">
        <div class="header-container">
            <img src="/static/logos/hardlink-manager-logo-3.png" alt="Logo" class="logo">
            <h1>Hardlink Manager</h1>
        </div>

        <form id="scan-form">
            <div class="form-group">
                <label for="path1">Directory Path:</label>
                <input type="text" id="path1" name="path1" required placeholder="/data/media">
                <small>Enter the full path accessible by the server (e.g., `/data/movies`).</small>
            </div>

            <div class="form-grid">
                <!-- Row 1: Checkbox Options -->
                <div class="option-card">
                    <label class="option-label" title="Files share the same data on disk. Saves space instantly.">
                        <input type="checkbox" id="hardlink" name="hardlink" checked
                            onchange="handleLinkTypeSelection(this)">
                        Hard Links (Recommended)
                    </label>
                </div>
                <div class="option-card">
                    <label class="option-label"
                        title="Creates a symbolic reference. Good for cross-filesystem (not here).">
                        <input type="checkbox" id="softlink" name="softlink" onchange="handleLinkTypeSelection(this)">
                        Soft Links (Symbolic)
                    </label>
                </div>
                <div class="option-card">
                    <label class="option-label" title="Simulates the process without making changes.">
                        <input type="checkbox" id="dryrun" name="dryrun" checked onchange="handleDryRunSelection(this)">
                        Dry Run (No changes)
                    </label>
                </div>
                <div class="option-card">
                    <label class="option-label"
                        title="Automatically save results to a JSON file in the scan directory.">
                        <input type="checkbox" id="save_auto" name="save_auto">
                        Auto-Save Results (JSON)
                    </label>
                </div>
            </div>

            <div class="form-grid" style="margin-top: 15px;">
                <!-- Row 2: Ignore Patterns -->
                <div class="input-card">
                    <label for="ignore_dirs">Ignore Directories:</label>
                    <input type="text" id="ignore_dirs" name="ignore_dirs" placeholder="e.g. .git, tmp, node_modules">
                </div>
                <div class="input-card">
                    <label for="ignore_exts">Ignore Extensions:</label>
                    <input type="text" id="ignore_exts" name="ignore_exts" placeholder="e.g. .log, .tmp, .bak">
                </div>
            </div>

            <div class="form-grid" style="margin-top: 15px;">
                <!-- Row 3: Size Filter -->
                <div class="input-card">
                    <label for="min_file_size">Minimum File Size:</label>
                    <div class="size-input-group">
                        <input type="number" id="min_file_size" name="min_file_size" min="0" value="0" placeholder="0">
                        <select id="min_file_size_unit" name="min_file_size_unit">
                            <option value="B">Bytes</option>
                            <option value="KB">KB</option>
                            <option value="MB" selected>MB</option>
                            <option value="GB">GB</option>
                        </select>
                    </div>
                    <small>Files smaller than this will be skipped.</small>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" id="submit-btn">Start Scan</button>
                <button type="button" id="clear-cache-btn">Clear Results</button>
                <button type="button" id="open-scheduler-btn" class="secondary-btn">Manage Schedules</button>
            </div>
        </form>

        <div id="status-message">
            <div class="progress-phases" id="progress-phases">
                <span class="progress-phase" data-phase="Finding Files">Finding</span>
                <span class="progress-phase" data-phase="Pre-Hashing">Pre-Hash</span>
                <span class="progress-phase" data-phase="Full Hashing">Hashing</span>
                <span class="progress-phase" data-phase="Analyzing Hashes">Analyzing</span>
                <span class="progress-phase" data-phase="Linking Files">Linking</span>
                <span class="progress-phase" data-phase="Complete">Done</span>
            </div>
            <div id="status-phase">Initializing...</div>
            <div id="status-details">Please wait.</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar-inner"></div>
            </div>
            <!-- Micro Progress Container -->
            <div id="micro-progress-container" style="display:none; margin-top: 5px; font-size: 0.85em; color: #666;">
                <ul id="micro-progress-list" style="list-style: none; padding: 0; margin: 0;"></ul>
            </div>
            <div id="status-stats" class="status-stats">
                <span id="status-count"></span>
                <span id="status-eta"></span>
            </div>
            <div class="control-buttons">
                <button type="button" id="pause-scan-btn" class="pause-btn" style="display:none;">Pause</button>
                <button type="button" id="cancel-scan-btn" class="cancel-btn" style="display:none;">Cancel Scan</button>
            </div>
        </div>

        <div id="error-message"></div>

        <div id="results">
            <h2>Scan Results</h2>
            <div class="results-button-bar">
                <button type="button" id="download-json-btn" class="secondary-btn">Download JSON</button>
                <button type="button" id="download-pdf-btn" class="secondary-btn">Download PDF</button>
            </div>
            <div id="summary-stats">
                <p><strong>Overall Status:</strong> <span id="result-action">N/A</span></p>
                <hr>
                <p><strong>Initial Size:</strong> <span id="result-before-size">N/A</span></p>
                <p><strong>Final Size (Theoretical):</strong> <span id="result-after-size">N/A</span></p>
                <p><strong>Space Saved:</strong> <span id="result-savings">N/A</span></p>

                <p><strong>Duration:</strong> <span id="result-duration">N/A</span></p>

                <div class="space-viz-container" id="space-viz" style="display:none; margin-top: 15px;">
                    <label>Space Usage (Estim.)</label>
                    <div class="viz-bar-wrapper">
                        <div class="viz-bar-used" id="viz-bar-used" style="width: 100%;"></div>
                        <div class="viz-bar-saved" id="viz-bar-saved" style="width: 0%;"></div>
                    </div>
                    <div class="viz-legend">
                        <span class="legend-item"><span class="color-box used"></span> Final Size</span>
                        <span class="legend-item"><span class="color-box saved"></span> Savings</span>
                    </div>
                </div>
            </div>
            <div id="link-actions">
                <p>Perform linking based on this dry run?</p>
                <div class="strategy-options" style="margin-bottom:10px;">
                    <label>Keep Strategy:</label>
                    <select id="link-strategy">
                        <option value="path">Alphabetical (Default)</option>
                        <option value="oldest">Keep Oldest File</option>
                        <option value="newest">Keep Newest File</option>
                        <option value="shortest_path">Keep Shortest Path</option>
                    </select>
                </div>
                <button id="perform-hardlink-btn" data-link-type="hard">Perform Hard Link</button>
                <button id="perform-softlink-btn" data-link-type="soft" class="softlink">Perform Soft Link</button>
            </div>
            <div id="filter-controls" class="filter-controls" style="display:none;">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="filter-path">Filter by path:</label>
                        <input type="text" id="filter-path" placeholder="Type to search paths..." />
                    </div>
                    <div class="filter-group">
                        <label for="filter-min-size">Min set size:</label>
                        <select id="filter-min-size">
                            <option value="0">All sizes</option>
                            <option value="1048576">≥ 1 MB</option>
                            <option value="10485760">≥ 10 MB</option>
                            <option value="104857600">≥ 100 MB</option>
                            <option value="1073741824">≥ 1 GB</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button type="button" id="clear-filter-btn" class="secondary-btn">Clear Filters</button>
                    </div>
                </div>
                <div id="filter-info" class="filter-info"></div>
            </div>
            <div id="duplicates">
            </div>
            <div id="pagination-controls" class="pagination-controls" style="display:none;">
                <button id="prev-page-btn" class="page-btn">Previous</button>
                <span id="page-info">Page 1 of 1</span>
                <button id="next-page-btn" class="page-btn">Next</button>
                <select id="page-size-select" class="page-select">
                    <option value="10">10 per page</option>
                    <option value="25" selected>25 per page</option>
                    <option value="50">50 per page</option>
                    <option value="100">100 per page</option>
                </select>
            </div>
        </div>
    </div>
    </div>

    <!-- Scheduler Modal -->
    <div id="scheduler-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Scheduled Scans</h2>
            <div id="schedule-list">
                <p>Loading...</p>
            </div>

            <hr>
            <h3>Add New Schedule</h3>
            <div class="schedule-form">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="sched-name" placeholder="Daily Backup Scan">
                </div>
                <div class="form-group">
                    <label>Path</label>
                    <input type="text" id="sched-path" placeholder="/data">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select id="sched-cron-preset">
                        <option value="0 0 * * *">Daily (Midnight)</option>
                        <option value="0 2 * * *">Daily (2 AM)</option>
                        <option value="0 0 * * 0">Weekly (Sunday)</option>
                        <option value="custom">Custom Cron...</option>
                    </select>
                    <input type="text" id="sched-cron-custom" placeholder="* * * * *"
                        style="display:none; margin-top:5px;">
                </div>
                <div class="form-group">
                    <label><input type="checkbox" id="sched-dryrun" checked> Dry Run Only</label>
                    <label><input type="checkbox" id="sched-hardlink"> Auto-Link (Hard)</label>
                </div>
                <button type="button" id="add-schedule-btn">Save Schedule</button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-preview-modal">&times;</span>
            <h3 id="preview-title">File Preview</h3>
            <pre id="preview-content"
                style="background:#f4f4f4; padding:10px; overflow:auto; max-height:400px; white-space: pre-wrap; color: black;"></pre>
        </div>
    </div>
</body>

</html>